{% extends "core/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
    <div class="content-section">
        <div class="media">
            <img class="rounded-circle account-img" src="{{ user.userprofile.picture.url }}">
            <div class="media-body">
                <h2 class="account-heading">{{ user.username }}</h2>
                <p class="text-secondary">{{ user.email }}</p>
            </div>

        <!-- FORM HERE -->
    </div>
    <hr>
    {% include "accounts/modal_user_edit.html" %}
    <br />
    <br />
    {% include "accounts/modal_userprofile_edit.html" %}
    <br />
    <br />
    {% include "accounts/modal_password_change.html" %}

    </div>
{% endblock content %}

{% block jquery %}
    <script>
        $(document).ready(function() {
            function clear_field() {
                $('#id_name').val('')
            }

             $("#password-change-form").submit(function (e) {
                e.preventDefault();
                var this_ = $(this),
                    formData = this_.serialize();

                $.ajax({
                    url: "/api/user/{{ user.id }}/",
                    data: formData,
                    method: "PATCH",
                    success: function (data) {
                        console.log(data);

                    },
                    error: function (data) {
                        console.log("error");
                        console.log(data.statusText);
                        console.log(data.status);
                        console.log(data)
                    }
                });
            });

            $("#user-edit-form").submit(function (e) {
                e.preventDefault();
                var this_ = $(this),
                    formData = this_.serialize();

                $.ajax({
                    url: "/api/user/{{ user.id }}/",
                    data: formData,
                    method: "PATCH",
                    success: function (data) {
                        console.log(data);

                    },
                    error: function (data) {
                        console.log("error");
                        console.log(data.statusText);
                        console.log(data.status);
                        console.log(data)
                    }
                });
            });

            $("#userprofile-edit-form").submit(function (e) {
                e.preventDefault();
                var formData = new FormData();

                formData.append( 'picture', ($(this).find('[type=file]')[0].files[0]));
                {#formData.append('_method', 'PATCH');#}

                $.ajax({
                    enctype: 'multipart/form-data',
                    url: "/api/profile/{{ user.id }}/",
                    data: formData,
                    method: "PATCH",
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        console.log(data);
                    },
                    error: function (data) {
                        console.log("error");
                        console.log(data.statusText);
                        console.log(data.status);
                        console.log(data)
                    }
                });
            });


        });

    </script>
{% endblock jquery %}